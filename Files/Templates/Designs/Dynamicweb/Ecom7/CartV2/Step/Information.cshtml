@inherits Dynamicweb.Rendering.RazorTemplateBase<Dynamicweb.Rendering.RazorTemplateModel<Dynamicweb.Rendering.Template>>

<script>
    var capitalize = function (s) {
        return s.charAt(0).toUpperCase() + s.substring(1);
    },

    useAddress = function (sender, type) {
        var el = sender.options[sender.selectedIndex];
        if (el) {
            var i, attribute;
            for (i = 0; attribute = el.attributes[i]; i++) {
                if (attribute.name.indexOf('data-') == 0) {
                    var key = capitalize(attribute.name.substring(5));
                    var target = document.getElementById('EcomOrder' + type + key);
                    if (target) {
                        target.value = attribute.value;
                    }
                }
            }
        }
    }
</script>

@helper RenderAddress(string type)
{
    var addresses = GetLoop("UserManagement:User.UserAddresses");

    if (addresses.Count > 0)
    {
        <div class="form-group">
            <label for="@(type)Address" class="col-sm-2 control-label">Select Address</label>
            <div class="col-sm-10">
                <select id="@(type)Address" class="form-control" onchange="useAddress(this, '@type')">
                    <option selected="selected">@Translate("Select_address", "Select address")</option>
                    @foreach (var address in addresses)
                    {
                        <option data-address='@address.GetValue("UserManagement:User.UserAddress.Address")'
                                data-address2='@address.GetValue("UserManagement:User.UserAddress.Address2")'
                                data-zip='@address.GetValue("UserManagement:User.UserAddress.Zip")'
                                data-city='@address.GetValue("UserManagement:User.UserAddress.City")'
                                data-state='@address.GetValue("UserManagement:User.UserAddress.State")'
                                data-country='@address.GetValue("UserManagement:User.UserAddress.Country")'>
                            @address.GetValue("UserManagement:User.UserAddress.Description")
                        </option>
                    }
                </select>
                <a href='Default.aspx?ID=@Pageview.Area.Item["UserManagementPageId"]&amp;ObjectID=@GetValue("Ecom:Order.Customer.AccessUserID")&amp;Action=ManageAddresses'>@Translate("Manage_addresses", "Manage addresses")</a>
            </div>
        </div>
    }

    <div class="form-group">
        <label for="EcomOrder@(type)Address" class="col-sm-2 control-label">Address</label>
        <div class="col-sm-10">
            <input class="form-control" type="text" name="EcomOrder@(type)Address" id="EcomOrder@(type)Address" value='@GetValue("Ecom:Order."+type+".Address")' />
        </div>
    </div>
    <div class="form-group">
        <label for="EcomOrder@(type)Address2" class="col-sm-2 control-label">Address Line 2</label>
        <div class="col-sm-10">
            <input class="form-control" type="text" name="EcomOrder@(type)Address2" id="EcomOrder@(type)Address2" value='@GetValue("Ecom:Order."+type+".Address2")' />
        </div>
    </div>
    <div class="form-group">
        <label for="EcomOrder@(type)Zip" class="col-sm-2 control-label">Zipcode</label>
        <div class="col-sm-10">
            <input class="form-control" type="number" name="EcomOrder@(type)Zip" id="EcomOrder@(type)Zip" value='@GetValue("Ecom:Order."+type+".Zip")' />
        </div>
    </div>
    <div class="form-group">
        <label for="EcomOrder@(type)City" class="col-sm-2 control-label">City</label>
        <div class="col-sm-10">
            <input class="form-control" type="text" name="EcomOrder@(type)City" id="EcomOrder@(type)City" value='@GetValue("Ecom:Order."+type+".City")' />
        </div>
    </div>
    <div class="form-group">
        <label for="EcomOrder@(type)Country" class="col-sm-2 control-label">Country</label>
        <div class="col-sm-10">
            <select class="form-control" name="EcomOrder@(type)Country" id="EcomOrder@(type)Country">
                @foreach (var country in GetLoop("Countries"))
                {
                    <option value='@country.GetValue("Ecom:Country.Code2")'>
                        @country.GetValue("Ecom:Country.Name")
                    </option>
                }
            </select>
        </div>
    </div>
}

<form name="ordersubmit" id="ordersubmit" method="post" role="form">
    <div class="form-horizontal" role="form">
        @{
            var errors = GetLoop("ValidationErrors");
            if (errors.Count > 0)
            {
                <div class="alert alert-danger validation-errors">
                    <p><strong>@Translate("Validation_errors", "Validation errors")</strong></p>
                    <ul>
                        @foreach (var error in errors)
                        {
                            <li>@error.GetValue("Ecom:Cart.ValidationError.FieldName"): @error.GetValue("Ecom:Cart.ValidationError.ErrorMessage")</li>
                        }
                    </ul>
                </div>
            }
        }

        <h3>Customer Information</h3>
        <div class="panel panel-default">
            <div class="panel-body">
                <h4>Billing address</h4>

                <div class="form-group">
                    <label for="EcomOrderCustomerName" class="col-sm-2 control-label">Name</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="text" name="EcomOrderCustomerName" id="EcomOrderCustomerName" value='@GetValue("Ecom:Order.Customer.Name")' />
                    </div>
                </div>
                <div class="form-group">
                    <label for="EcomOrderCustomerEmail" class="col-sm-2 control-label">E-mail</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="email" name="EcomOrderCustomerEmail" id="EcomOrderCustomerEmail" value='@GetValue("Ecom:Order.Customer.Email")' />
                    </div>
                </div>
                <div class="form-group">
                    <label for="EcomOrderCustomerPhone" class="col-sm-2 control-label">Phone</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="number" name="EcomOrderCustomerPhone" id="EcomOrderCustomerPhone" value='@GetValue("Ecom:Order.Customer.Phone")' />
                    </div>
                </div>

                @RenderAddress("Customer")
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                <h4>Delivery Address</h4>

                <div class="form-group">
                    <label for="EcomOrderCustomerName" class="col-sm-2 control-label">Name</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="text" name="EcomOrderDeliveryName" id="EcomOrderDeliveryName" value='@GetValue("Ecom:Order.Delivery.Name")' />
                    </div>
                </div>
                <div class="form-group">
                    <label for="EcomOrderCustomerEmail" class="col-sm-2 control-label">E-mail</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="email" name="EcomOrderDeliveryEmail" id="EcomOrderDeliveryEmail" value='@GetValue("Ecom:Order.Delivery.Email")' />
                    </div>
                </div>
                <div class="form-group">
                    <label for="EcomOrderCustomerPhone" class="col-sm-2 control-label">Phone</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="number" name="EcomOrderDeliveryPhone" id="EcomOrderDeliveryPhone" value='@GetValue("Ecom:Order.Delivery.Phone")' />
                    </div>
                </div>

                @RenderAddress("Delivery")
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                @if (string.IsNullOrWhiteSpace(GetString("Global:Extranet.Name")))
                {
                    <h4>Create new user</h4>



                    <div class="form-group">
                        <label for="EcomUserCreateUserName" class="col-sm-2 control-label">@Translate("username", "Username")</label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="EcomUserCreateUserName" id="EcomUserCreateUserName" />
                        </div>
                    </div>
                    <div class="form-group">

                        <label for="EcomUserCreatePassword" class="col-sm-2 control-label">@Translate("New_password", "New password")</label>
                        <div class="col-sm-10">
                            <input class="form-control" type="password" name="EcomUserCreatePassword" id="EcomUserCreatePassword" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="EcomUserCreateConfirmPassword" class="col-sm-2 control-label">@Translate("Confirm_password", "Confirm password")</label>
                        <div class="col-sm-10">
                            <input class="form-control" type="password" name="EcomUserCreateConfirmPassword" id="EcomUserCreateConfirmPassword" />
                        </div>
                    </div>
                    <div class="checkbox">
                        <div class="col-sm-2"></div>
                        <label class="col-sm-2">
                            <input type="checkbox" name="EcomUserCreateNew" id="EcomUserCreateNew" checked='@GetBoolean("Ecom:User.CreateNew")' />
                            @Translate("Save_me_as_customer", "Save me as customer")
                        </label>

                    </div>
                    <h4>
                        @Translate("Already_a_user", "Already a user?") <a href='Default.aspx?ID=@Pageview.Area.Item["SignInPageId"]'>
                            @Translate("Sign_in", "Sign in")
                        </a>
                    </h4>
                }



            </div>
        </div>



        <h4>Payment and delivery</h4>
        <div class="panel panel-default">
            <div class="panel-body">

                @if (Loops.Contains("Paymethods"))
                {
                    <h4>Paymentmethods</h4>
                    <div>
                        @foreach (var i in GetLoop("Paymethods"))
                        {

                            <div class="radio">
                                <label class="col-sm-10">
                                    <input type="radio" name="EcomCartPaymethodID" id='EcomCartPaymethodID_@i.GetValue("Ecom:Cart.Paymethod.ID")' value='@i.GetValue("Ecom:Cart.Paymethod.ID")' checked='@GetBoolean("Ecom:Cart.Paymethod.IsSelected")' />
                                    @i.GetValue("Ecom:Cart.Paymethod.Name")
                                </label>
                            </div>
                        }
                    </div>

                }
                @if (Loops.Contains("Shippingmethods"))
                {
                    <h4>Deliverymethods</h4>
                    <div>
                        @foreach (var i in GetLoop("Shippingmethods"))
                        {

                            <div class="radio">
                                <label class="col-sm-10">
                                    @if (GetBoolean("Ecom:Cart.Shippingmethod.IsSelected"))
                                    {
                                        <input type="radio" name="EcomCartShippingID" id='EcomCartShippingID_@i.GetValue("Ecom:Cart.Shipping.ID")' value='@i.GetValue("Ecom:Cart.Shipping.ID")' checked=" checked" />
                                        @i.GetValue("Ecom:Cart.Shippingmethod.Name")
                                    }
                                    else
                                    {
                                        <input type="radio" name="EcomCartShippingID" id='EcomCartShippingID_@i.GetValue("Ecom:Cart.Shipping.ID")' value='@i.GetValue("Ecom:Cart.Shipping.ID")' />
                                        @i.GetValue("Ecom:Cart.Shippingmethod.Name")
                                    }
                                </label>
                            </div>
                        }
                    </div>

                }




            </div>

        </div>

        @if (GetBoolean("Ecom:Cart.UseNewsletterSubscription"))
        {

            <h4>Newsletter</h4>


            <input class="form-control" type="hidden" name="EcomOrderSubscribeToNewsletter" />
            <div class="checkbox">


                <label for="EcomOrderSubscribeToNewsletter">
                    <input type="checkbox" name="EcomOrderSubscribeToNewsletter" id="EcomOrderSubscribeToNewsletter" checked='@GetBoolean("Ecom:Order.Customer.NewsletterSubscribe")' />
                    @Translate("Subscribe_to_newsletter", "Subscribe to newsletter")
                </label>
            </div>
        }



        <h4><a href='Default.aspx?ID=@Pageview.Area.Item["TermsAndConditionsPageId"]'>Terms and conditions</a></h4>



        <div class="checkbox">
            <label>
                <input type="checkbox" id="EcomOrderCustomerAccepted" name="EcomOrderCustomerAccepted" value="1" />

                Accept terms and conditions
            </label>
        </div>

        <button type="submit" name='@GetValue("CartV2.PreviousStepButtonName")' id='@GetValue("CartV2.PreviousStepButtonName")' value="Tilbage" class="submitter btn btn-primary">@Translate("Back", "Back")</button>
        <button type="submit" name='@GetValue("CartV2.NextStepButtonName")' id='@GetValue("CartV2.NextStepButtonName")' class="submitter btn btn-primary">@Translate("Create_order", "Create order")</button>
    </div>
</form>
